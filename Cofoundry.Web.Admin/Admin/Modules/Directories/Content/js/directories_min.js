angular.module("cms.directories",["ngRoute","cms.shared"]).constant("_",window._).constant("directories.modulePath","/Admin/Modules/Directories/Js/");
angular.module("cms.directories").config(["$routeProvider","shared.routingUtilities","directories.modulePath",function(r,e,i){e.registerCrudRoutes(r,i,"Directory")}]);
angular.module("cms.directories").factory("directories.directoryService",["$http","_","shared.serviceBase","directories.DirectoryTree",function(r,e,t,n){var u={},c=t+"page-directories";function i(e){return c+"/"+e}function o(e){return i(e)+"/access-rules"}return u.getAll=function(){return r.get(c)},u.getTree=function(){return r.get(c+"/tree").then(function(e){return e&&new n(e)})},u.getById=function(e){return r.get(i(e))},u.getAccessRulesByPageDirectoryId=function(e){return r.get(o(e))},u.add=function(e){return r.post(c,e)},u.update=function(e){return r.patch(i(e.pageDirectoryId),e)},u.remove=function(e){return r.delete(i(e))},u.updateUrl=function(e){return r.put(i(e.pageDirectoryId)+"/url",e)},u.updateAccessRules=function(e){return r.patch(o(e.pageDirectoryId),e)},u}]);
angular.module("cms.directories").factory("directories.DirectoryTree",["_",function(i){return function(r){var e=this;i.extend(e,r),e.flatten=function(t){var r=[];return function e(r,n){if(r.pageDirectoryId==t)return;n.push(r);i.each(r.childPageDirectories,function(r){e(r,n)})}(e,r),r},e.findNodeById=function(t){return function e(r){var n;if(!r)return;r.forEach(function(r){n=n||(r.pageDirectoryId==t?r:e(r.childPageDirectories))});return n}([e])}}}]);
angular.module("cms.directories").directive("cmsDirectoryGrid",["shared.permissionValidationService","directories.modulePath",function(e,r){return{restrict:"E",templateUrl:r+"UIComponents/DirectoryGrid.html",scope:{pageDirectories:"=cmsDirectories",redirect:"=cmsRedirect"},replace:!1,controller:function(){this.canUpdate=e.canUpdate("COFDIR")},controllerAs:"vm",bindToController:!0}}]);
angular.module("cms.directories").directive("cmsDirectoryPath",["directories.modulePath",function(r){return{restrict:"E",templateUrl:r+"UIComponents/DirectoryPath.html",scope:{pageDirectory:"=cmsDirectory"},replace:!1,controller:function(){},controllerAs:"vm",bindToController:!0}}]);
angular.module("cms.directories").controller("ChangeDirectoryUrlController",["$scope","$q","shared.LoadState","directories.directoryService","options","close",function(e,t,r,a,o,i){var n=e;function c(){n.submitLoadState.on(),a.updateUrl(n.command).then(o.onSave).then(i).finally(n.submitLoadState.off)}(function(){var e=o.pageDirectory;n.pageDirectory=e,n.selectableParentDirectories=o.selectableParentDirectories,n.hasChildContent=o.hasChildContent,n.command={pageDirectoryId:e.pageDirectoryId,urlPath:e.urlPath,parentPageDirectoryId:e.parentPageDirectoryId}})(),n.submitLoadState=new r,n.save=c,n.close=i}]);
angular.module("cms.directories").controller("AddDirectoryController",["$location","shared.stringUtilities","shared.LoadState","directories.directoryService",function(o,t,e,a){var n=this;function d(){n.globalLoadState.on(),a.add(n.command).then(c,n.globalLoadState.off)}function r(){n.formLoadState.off()}function i(){c()}function c(){o.path("/")}n.command={},n.formLoadState=new e(!0),n.globalLoadState=new e,n.editMode=!1,n.save=d,n.cancel=i,n.onDirectoriesLoaded=r}]);
angular.module("cms.directories").controller("DirectoryDetailsController",["$routeParams","$q","$location","_","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","shared.userAreaService","shared.internalModulePath","directories.modulePath","directories.directoryService",function(t,o,e,n,r,i,a,c,l,s,d){var u=this,f="COFDIR";function h(){u.editMode=!0,u.mainForm.formStatus.clear()}function y(){U(u.saveLoadState),d.update(u.command).then(v.bind(null,"Changes were saved successfully")).finally(b.bind(null,u.saveLoadState))}function m(){u.editMode=!1,u.command=C(u.pageDirectory),u.mainForm.formStatus.clear()}function D(){var e={title:"Delete Directory",message:"Deleting this directory will delete ALL sub-directories and pages linked to this directory. Are you sure you want to continue?",okButtonTitle:"Yes, delete it",onOk:function(){return U(),d.remove(u.pageDirectory.pageDirectoryId).then(P).catch(b)}};i.confirm(e)}function g(){i.show({templateUrl:l+"UIComponents/EntityAccess/EntityAccessEditor.html",controller:"EntityAccessEditorController",options:{entityDefinitionCode:f,entityIdPrefix:"pageDirectory",entityDefinitionName:"Directory",entityDescription:u.pageDirectory.fullUrlPath,entityAccessLoader:function(){return d.getAccessRulesByPageDirectoryId(u.pageDirectory.pageDirectoryId)},saveAccess:d.updateAccessRules}})}function p(){i.show({templateUrl:s+"Routes/Modals/ChangeDirectoryUrl.html",controller:"ChangeDirectoryUrlController",options:{pageDirectory:u.pageDirectory,selectableParentDirectories:u.selectableParentDirectories,hasChildContent:u.hasChildContent,onSave:v.bind(null,"Url Changed")}})}function v(e){return S().then(u.mainForm.formStatus.success.bind(null,e))}function S(e){var n=t.id;return o.all([d.getTree().then(function(e){var t=e.findNodeById(n);u.pageDirectory=t,u.parentDirectory=e.findNodeById(t.parentPageDirectoryId),u.selectableParentDirectories=e.flatten(n),u.command=C(t),u.editMode=!1,u.hasChildContent=t.numPages||t.childPageDirectories.length}),c.getAll().then(function(e){u.accessRulesEnabled=1<e.length})]).then(b.bind(null,e))}function C(e){return n.pick(e,"pageDirectoryId","name")}function P(){e.path("")}function U(e){u.globalLoadState.on(),e&&n.isFunction(e.on)&&e.on()}function b(e){u.globalLoadState.off(),e&&n.isFunction(e.off)&&e.off()}u.edit=h,u.save=y,u.cancel=m,u.deleteDirectory=D,u.viewAccessRules=g,u.changeUrl=p,u.editMode=!1,u.globalLoadState=new r,u.saveLoadState=new r,u.formLoadState=new r(!0),u.canUpdate=a.canUpdate(f),u.canUpdateUrl=a.hasPermission(f+"UPDURL"),u.canDelete=a.canDelete(f),S(u.formLoadState)}]);
angular.module("cms.directories").controller("DirectoryListController",["_","shared.LoadState","shared.SearchQuery","shared.permissionValidationService","directories.directoryService",function(e,r,t,a,i){var o=this;o.gridLoadState=new r,o.canCreate=a.canCreate("COFDIR"),o.gridLoadState.on(),i.getTree().then(function(e){e=e.flatten();o.result=e,o.gridLoadState.off()})}]);