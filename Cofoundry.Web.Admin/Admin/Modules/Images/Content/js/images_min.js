angular.module("cms.images",["ngRoute","cms.shared"]).constant("_",window._).constant("images.modulePath","/Admin/Modules/Images/Js/");
angular.module("cms.images").config(["$routeProvider","shared.routingUtilities","images.modulePath",function(e,i,r){i.registerCrudRoutes(e,r,"Image")}]);
angular.module("cms.images").factory("images.imageService",["$http","shared.imageService",function(r,e){var t=_.extend({},e);return t.remove=function(e){return r.delete(t.getIdRoute(e))},t}]);
angular.module("cms.images").controller("AddImageController",["$location","$scope","_","shared.focusService","shared.stringUtilities","shared.LoadState","images.imageService",function(e,a,t,i,o,n,s){var c=this;function d(){c.saveLoadState.on(),s.add(c.command).progress(c.saveLoadState.setProgress).then(l)}function r(){var e=c.command;e.file&&e.file.name&&(e.title=o.capitaliseFirstLetter(o.getFileNameWithoutExtension(e.file.name)),i.focusById("title"))}function m(){l()}function l(){e.path("")}c.command={},c.save=d,c.cancel=m,a.$watch("vm.command.file",r),c.editMode=!1,c.saveLoadState=new n}]);
angular.module("cms.images").controller("ImageDetailsController",["$routeParams","$q","$location","_","shared.LoadState","shared.modalDialogService","shared.permissionValidationService","shared.urlLibrary","images.imageService","images.modulePath",function(a,e,t,o,n,i,r,m,s,d){var l=this;function c(){l.editMode=!0,l.mainForm.formStatus.clear()}function u(){p(l.saveLoadState),s.update(l.command).progress(l.saveLoadState.setProgress).then(function(e,a){return v(a).then(l.mainForm.formStatus.success.bind(null,e))}.bind(null,"Changes were saved successfully",l.saveLoadState))}function g(){l.editMode=!1,l.previewImage=o.clone(l.image),l.command=h(l.image),l.previewUrl=m.getImageUrl(l.previewImage),l.mainForm.formStatus.clear()}function f(){var e={title:"Delete Image",message:"Are you sure you want to delete this image?",okButtonTitle:"Yes, delete it",onOk:function(){return p(),s.remove(l.image.imageAssetId).then(S).catch(I)}};i.confirm(e)}function v(e){return s.getById(a.id).then(function(e){l.image=e,l.previewImage=e,l.command=h(e),l.previewUrl=m.getImageUrl(l.previewImage),l.editMode=!1}).then(I.bind(null,e))}function h(e){return o.pick(e,"imageAssetId","title","tags","defaultAnchorLocation")}function S(){t.path("")}function p(e){l.globalLoadState.on(),e&&o.isFunction(e.on)&&e.on()}function I(e){l.globalLoadState.off(),e&&o.isFunction(e.off)&&e.off()}l.edit=c,l.save=u,l.cancel=g,l.remove=f,l.editMode=!1,l.globalLoadState=new n,l.saveLoadState=new n,l.formLoadState=new n(!0),l.canDelete=r.canDelete("COFIMG"),l.canUpdate=r.canUpdate("COFIMG"),v(l.formLoadState)}]);
angular.module("cms.images").controller("ImageListController",["_","shared.LoadState","shared.SearchQuery","shared.permissionValidationService","images.imageService",function(t,e,a,i,r){var n=this;function o(e){n.isFilterVisible=t.isUndefined(e)?!n.isFilterVisible:e}function l(){o(!1),s()}function s(){return n.gridLoadState.on(),r.getAll(n.query.getParameters()).then(function(e){n.result=e,n.gridLoadState.off()})}n.gridLoadState=new e,n.query=new a({onChanged:l}),n.filter=n.query.getFilters(),n.toggleFilter=o,n.canCreate=i.canCreate("COFIMG"),n.canUpdate=i.canUpdate("COFIMG"),o(!1),s()}]);